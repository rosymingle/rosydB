const cldPlayer="https://cdn.jsdelivr.net/npm/cloudinary-video-player@2.3.3/dist/cld-video-player.min.js",videoJS="https://vjs.zencdn.net/8.5.2/video.min.js",hlsPlugin="https://cdn.jsdelivr.net/npm/videojs-contrib-hls@5.15.0/dist/videojs-contrib-hls.min.js",qualityValues=["best","good","eco","low"];function loadScript(src){return new Promise(((resolve,reject)=>{const script=document.createElement("script");script.src=src,script.setAttribute("crossorigin","anonymous"),script.setAttribute("referrerpolicy","no-referrer"),script.onload=()=>resolve(),script.onerror=()=>reject(new Error(`Failed to load script: ${src}`)),document.head.appendChild(script)}))}async function loadScriptsInOrder(){try{if(console.log("Starting to load VideoJS"),await loadScript(videoJS),console.log("VideoJS loaded successfully"),await new Promise((resolve=>setTimeout(resolve,100))),"undefined"==typeof videojs)throw new Error("Video.js failed to initialize properly");console.log("Starting to load HLS plugin"),await loadScript(hlsPlugin),console.log("HLS plugin loaded successfully")}catch(error){console.error("Script loading failed:",error)}}$(document).ready((function(){$(".video[data-pid]").length>0&&$(".video").each((function(){const videoOld=$(this),desktopSource=videoOld.attr("data-pid"),mobileSource=videoOld.attr("m-data-pid"),tabletSource=videoOld.attr("t-data-pid"),mbRatio=videoOld.attr("m-data-ratio"),dtRatio=videoOld.attr("data-ratio"),tbRatio=videoOld.attr("t-data-ratio"),videoQuality=videoOld.attr("quality")||videoOld.attr("data-quality");if(videoOld.is(".in-situ")){const videoCover=videoOld.html(),endByPoster=videoOld.hasClass("poster-end");videoOld.replaceWith(`<div class="video in-situ video-area">\n\t\t\t\t\t  <div class="in-situ-cover pointer">${videoCover}</div>\n\t\t\t\t\t  <video \n\t\t\t\t\t  controls\n\t\t\t\t\t  class="in-situ og-snippet cld-video-player cld-fluid ${endByPoster?"poster-end":""}"\n\t\t\t\t\t  data-pid=${desktopSource}\n\t\t\t\t\t  data-ratio=${dtRatio}\n\t\t\t\t\t  ${mobileSource?`m-data-pid=${mobileSource}`:""}\n\t\t\t\t\t  ${mbRatio?`m-data-ratio=${mbRatio}`:""}\n\t\t\t\t\t  ${tabletSource?`t-data-pid=${tabletSource}`:""}\n\t\t\t\t\t  ${tbRatio?`t-data-ratio=${tbRatio}`:""}\n\t\t\t\t\t  ${videoQuality?`quality=${videoQuality}`:'quality="auto"'}>\n\t\t\t\t\t  </video>\n\t\t\t\t\t  \n\t\t\t\t\t  </div>`)}else if(videoOld.is(".popup")){const popupCTA=videoOld.html(),className=$.trim(`${videoOld.hasClass("cta-border")?"cta-border":""} ${videoOld.hasClass("cta-ul")?"cta-ul":""} ${videoOld.hasClass("cta-solid")?"cta-solid":""} ${videoOld.hasClass("cta-arrow")?"cta-arrow":""}`);videoOld.replaceWith(`<div class="video popup video-area">\n\t\t\t\t\t  <a class="${className}"\n\t\t\t\t\t  href="#">${popupCTA}</a>\n\t\t\t\t\t  <video \n\t\t\t\t\t  controls\n\t\t\t\t\t  class="popup og-snippet cld-video-player cld-fluid disp-no"\n\t\t\t\t\t  data-pid=${desktopSource}\n\t\t\t\t\t  data-ratio=${dtRatio}\n\t\t\t\t\t  ${mobileSource?`m-data-pid=${mobileSource}`:""}\n\t\t\t\t\t  ${mbRatio?`m-data-ratio=${mbRatio}`:""}\n\t\t\t\t\t  ${tabletSource?`t-data-pid=${tabletSource}`:""}\n\t\t\t\t\t  ${tbRatio?`t-data-ratio=${tbRatio}`:""}\n\t\t\t\t\t  ${videoQuality?`quality=${videoQuality}`:'quality="auto"'}>\n\t\t\t\t\t  </video>\n\t\t\t\t\t  </div>`)}else videoOld.is(".autoplay")?videoOld.replaceWith(`<div class="video autoplay video-area">\n\t\t\t\t\t  <video \n\t\t\t\t\t  autoplay\n\t\t\t\t\t  muted\n\t\t\t\t\t  loop\n\t\t\t\t\t  loading="lazy"\n\t\t\t\t\t  playsinline\n\t\t\t\t\t  webkit-playsinline\n\t\t\t\t\t  class="autoplay og-snippet cld-video-player cld-fluid"\n\t\t\t\t\t  data-pid=${desktopSource}\n\t\t\t\t\t  data-ratio=${dtRatio}\n\t\t\t\t\t  ${mobileSource?`m-data-pid=${mobileSource}`:""}\n\t\t\t\t\t  ${mbRatio?`m-data-ratio=${mbRatio}`:""}\n\t\t\t\t\t  ${tabletSource?`t-data-pid=${tabletSource}`:""}\n\t\t\t\t\t  ${tbRatio?`t-data-ratio=${tbRatio}`:""}\n\t\t\t\t\t  ${videoQuality?`quality=${videoQuality}`:'quality="auto"'}>\n\t\t\t\t\t  </video>\n\t\t\t\t\t  </div>`):(videoOld.replaceWith(`<div class="video video-area">\n\t\t\t\t\t  <video \n\t\t\t\t\t  controls\n\t\t\t\t\t  loading="lazy"\n\t\t\t\t\t  class="og-snippet cld-video-player cld-fluid"\n\t\t\t\t\t  data-pid=${desktopSource}\n\t\t\t\t\t  data-ratio=${dtRatio}\n\t\t\t\t\t  ${mobileSource?`m-data-pid=${mobileSource}`:""}\n\t\t\t\t\t  ${mbRatio?`m-data-ratio=${mbRatio}`:""}\n\t\t\t\t\t  ${tabletSource?`t-data-pid=${tabletSource}`:""}\n\t\t\t\t\t  ${tbRatio?`t-data-ratio=${tbRatio}`:""}\n\t\t\t\t\t  ${videoQuality?`quality=${videoQuality}`:'quality="auto"'}>\n\t\t\t\t\t  </video>\n\t\t\t\t\t  </div>`),console.log("Replace Success"))})),$("video[data-pid]").length>0&&"undefined"==typeof cloudinary&&(document.head.innerHTML+='<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cloudinary-video-player@2.3.3/dist/cld-video-player.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />',loadScriptsInOrder(),loadScript(cldPlayer).then((()=>{console.log("Cloudinary video player loaded successfully"),$("video").each((function(){var video=$(this);const id=`video${Math.floor(1e4*Math.random())}`;video.attr("id",id);const vplayer=cloudinary.videoPlayer(id,{cloud_name:"david-jones",secure:!0,analytics:!0,logoOnclickUrl:"#",logoImageUrl:"null",controls:!0,bigPlayButton:!video.is(".in-situ")}),mobileSource=video.attr("m-data-pid"),desktopSource=video.attr("data-pid"),tabletSource=video.attr("t-data-pid");if(desktopSource.length>0){const viewportWidth=window.innerWidth||document.documentElement.clientWidth,mobilePoster=video.attr("m-data-poster"),tabletPoster=video.attr("t-data-poster"),desktopPoster=video.attr("data-poster");let poster={};const mbRatio=video.attr("m-data-ratio"),tbRatio=video.attr("t-data-ratio"),dtRatio=video.attr("data-ratio");let source,videoRatio="";viewportWidth<768&&(source=mobileSource||desktopSource,console.log("MOBILE SOURCE:",source),poster={poster:mobilePoster?`https://res.cloudinary.com/david-jones/image/upload/v1687498676/${mobilePoster}.jpg`:null},videoRatio=mbRatio||""),viewportWidth>=768&&viewportWidth<=1024&&(source=tabletSource||desktopSource,console.log("TABLET SOURCE:",source),poster={poster:tabletPoster?`https://res.cloudinary.com/david-jones/image/upload/v1687498676/${tabletPoster}.jpg`:null},videoRatio=tbRatio||""),viewportWidth>1024&&(source=desktopSource,poster={poster:desktopPoster?`https://res.cloudinary.com/david-jones/image/upload/v1687498676/${desktopPoster}.jpg`:null},videoRatio=dtRatio||""),vplayer.source(source,{transformation:{streaming_profile:"auto"},sourceTypes:["hls","dash","mp4"],fallback:!0,eager_async:!0,useUrlGeneration:!1},poster);const aspect=videoRatio.split(":"),mVidRatio=aspect[1]/aspect[0]*100;document.getElementById(id).style.paddingTop=`${mVidRatio}%`}}));const popupWrapper=$("div.popup.cld-video-player");popupWrapper.length>0&&popupWrapper.each((function(){const popupTriggerContainer=$(this).closest(".video-area"),popupID=$(this).attr("id");$("body").append('<div class="videoPopup-'+popupID+' eacss" style="display:none;z-index:99;"><div class="pos-f pad-70 m-pad-40 bg-black-50" style="top:0;right:0;bottom:0;left:0;z-index:99;"><div class="wrapper-1200 m-wrapper-400 pos-r mrgn-lr-a"><a class="icon icon-budicon-1 pointer pos-a-tr white fs-25 pad-r-5" style="z-index: 99; margin-right: -40px;"></a></div></div></div>'),$(this).appendTo(".videoPopup-"+popupID+" .pos-r"),$(this).show(),console.log(popupID,"is popped");const closeBtn=$(".videoPopup-"+popupID).find(".icon-budicon-1"),media=document.getElementById(`${popupID}_html5_api`);let urlParams=window.location.search;urlParams=new URLSearchParams(urlParams);const videoPopupLayer=$(".videoPopup-"+popupID),isAutoPop="true"===urlParams.get("autopop"),isAutoPlay="true"===urlParams.get("autoplay");isAutoPop&&media&&(videoPopupLayer.toggle(),isAutoPlay&&(window.onload=function(){media.muted=!0,media.autoplay=!0,media.play()})),popupTriggerContainer.click((()=>($(".videoPopup-"+popupID).toggle(),media.play(),!1))),closeBtn.click((()=>(media.pause(),$(".videoPopup-"+popupID).toggle(),media.currentTime=0,!1)))}));const inSituVideo=$(".og-snippet.cld-video-player.in-situ");inSituVideo.length>0&&inSituVideo.each((function(){const convertedVdPoster=$(this).closest(".video-area").find(".in-situ-cover");convertedVdPoster.length&&($(this).hide(),convertedVdPoster.click((()=>{convertedVdPoster.hide(),$(this).fadeIn(200),$(this).find("video").get(0).play()})),$(this).hasClass("poster-end")&&$(this).find("video").get(0).addEventListener("ended",(()=>{$(this).fadeOut(100),convertedVdPoster.show()})))}));const autoPlayers=$("div.autoplay.cld-video-player");(/iPhone/i.test(navigator.userAgent)||$("body").hasClass("iphone"))&&($("video").each((function(){$(this).show()})),autoPlayers.length>0&&autoPlayers.each((function(){const autoplayID=$(this).attr("id");document.getElementById(`${autoplayID}_html5_api`).play()}))),setTimeout((()=>{$("video").each((function(){var video=$(this);const videoSrc=video.attr("src");let quality=video.attr("quality");if(void 0!==quality&&qualityValues.includes(quality)&&"eco"!==quality){let newURL=`upload/q_auto:${quality}/f_auto:video`,newSrc=videoSrc.replace("upload",newURL);video.attr("src",newSrc)}}))}),1e3)})).catch((error=>{console.error("Failed to load Cloudinary video player:",error)})))}));